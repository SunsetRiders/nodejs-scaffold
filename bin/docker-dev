#!/bin/bash

##########
# script variables
##########
BIN_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
PROJECT_DIR="$( dirname "$BIN_DIR" )"

UP_OR_DOWN=$1

##########
# environment validations
##########
if [[ -x `which docker-compose` ]]
then
  DOCKER_COMPOSE_INSTALLED=true
else
  DOCKER_COMPOSE_INSTALL_URL="https://docs.docker.com/compose/install/"
  echo "docker-compose should be installed in your machine"
  echo "check how to do it in: $DOCKER_COMPOSE_INSTALL_URL"
  DOCKER_COMPOSE_INSTALLED=false
fi

if [[ -e "$PROJECT_DIR/Dockerfile" ]]
then
  DOCKER_FILE_EXISTS=true
else
  echo "Dockerfile is missing at '$PROJECT_DIR'."
  DOCKER_FILE_EXISTS=false
fi

if [[ -e "$PROJECT_DIR/docker-compose.yml" ]]
then
  DOCKER_COMPOSE_FILE_EXISTS=true
else
  echo "docker-compose.yml is missing at '$PROJECT_DIR'."
  DOCKER_COMPOSE_FILE_EXISTS=false
fi

##########
# executing actions
##########
if [[ $DOCKER_COMPOSE_INSTALLED && $DOCKER_FILE_EXISTS && \
  $DOCKER_COMPOSE_FILE_EXISTS ]]
then
  if [[ $UP_OR_DOWN == "up" ]]
  then
    cd $PROJECT_DIR && docker-compose build && docker-compose $UP_OR_DOWN
  elif [[ $UP_OR_DOWN == "down" ]]
  then
    cd $PROJECT_DIR && docker-compose $UP_OR_DOWN
  else
    echo "Only accepted parameters are:"
    echo "  'up'   - if you want to run the application;"
    echo "  'down' - if you want to shutdown the application;"
  fi
fi

